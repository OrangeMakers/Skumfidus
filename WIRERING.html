<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ledningsdiagram for ESP32-projekt</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; padding: 20px; }
        h1 { color: #333; }
        table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        pre { background-color: #f4f4f4; border: 1px solid #ddd; padding: 10px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>Ledningsdiagram for ESP32, TMC2209 Stepperdriver, Steppermotor, LCD, Relæ og Startknap</h1>

    <h2>ESP32-forbindelser</h2>
    <table>
        <tr><th>ESP32-pin</th><th>Forbindelse</th></tr>
        <tr><td>D13 (PIN 13)</td><td>TMC2209 STEP</td></tr>
        <tr><td>D12 (PIN 12)</td><td>TMC2209 DIR</td></tr>
        <tr><td>D2 (PIN 2)</td><td>Indbygget LED</td></tr>
        <tr><td>SDA (PIN 21)</td><td>LCD SDA</td></tr>
        <tr><td>SCL (PIN 22)</td><td>LCD SCL</td></tr>
        <tr><td>D14 (PIN 14)</td><td>Relæ-kontrol</td></tr>
        <tr><td>D15 (PIN 15)</td><td>Startknap (PULL UP)</td></tr>
        <tr><td>D16 (PIN 16)</td><td>Homing-kontakt (PULL UP)</td></tr>
        <tr><td>D17 (PIN 17)</td><td>Rotary Encoder CLK (PULL UP)</td></tr>
        <tr><td>D18 (PIN 18)</td><td>Rotary Encoder DT (PULL UP)</td></tr>
        <tr><td>D19 (PIN 19)</td><td>Rotary Encoder SW (PULL UP)</td></tr>
        <tr><td>5V</td><td>Fælles 5V (til LCD, TMC2209, Rotary Encoder og andre komponenter)</td></tr>
        <tr><td>GND</td><td>Fælles GND</td></tr>
    </table>

    <h2>Rotary Encoder-forbindelser</h2>
    <table>
        <tr><th>Encoder-pin</th><th>Forbindelse</th></tr>
        <tr><td>CLK</td><td>ESP32 D17 (PIN 17)</td></tr>
        <tr><td>DT</td><td>ESP32 D18 (PIN 18)</td></tr>
        <tr><td>SW</td><td>ESP32 D19 (PIN 19)</td></tr>
        <tr><td>+ (VCC)</td><td>Fælles 5V</td></tr>
        <tr><td>GND</td><td>Fælles GND</td></tr>
    </table>

    <h2>Homing-kontakt-forbindelser</h2>
    <table>
        <tr><th>Kontakt-pin</th><th>Forbindelse</th></tr>
        <tr><td>Pin 1</td><td>ESP32 D16 (PIN 16)</td></tr>
        <tr><td>Pin 2</td><td>Fælles GND</td></tr>
    </table>

    <h2>TMC2209-forbindelser</h2>
    <table>
        <tr><th>TMC2209-pin</th><th>Forbindelse</th></tr>
        <tr><td>STEP</td><td>ESP32 D13</td></tr>
        <tr><td>DIR</td><td>ESP32 D12</td></tr>
        <tr><td>EN</td><td>GND</td></tr>
        <tr><td>MS1</td><td>GND (for fuld-step tilstand)</td></tr>
        <tr><td>MS2</td><td>GND (for fuld-step tilstand)</td></tr>
        <tr><td>VCC_IO</td><td>Fælles 5V</td></tr>
        <tr><td>VM</td><td>Fælles 5V</td></tr>
        <tr><td>GND</td><td>Fælles GND</td></tr>
        <tr><td>A1</td><td>Steppermotor Spole A (Rød)</td></tr>
        <tr><td>A2</td><td>Steppermotor Spole A (Blå)</td></tr>
        <tr><td>B1</td><td>Steppermotor Spole B (Sort)</td></tr>
        <tr><td>B2</td><td>Steppermotor Spole B (Grøn)</td></tr>
    </table>

    <h2>Startknap-forbindelser</h2>
    <table>
        <tr><th>Knap-pin</th><th>Forbindelse</th></tr>
        <tr><td>Pin 1</td><td>ESP32 D15 (PIN 15)</td></tr>
        <tr><td>Pin 2</td><td>Fælles GND</td></tr>
    </table>

    <h2>Simpelt ledningsdiagram</h2>
    <pre>
    ESP32          TMC2209         Steppermotor     Rotary Encoder
    +--------+     +--------+     +-------------+   +-------------+
    |    D13 |---->| STEP   |     |             |   |             |
    |    D12 |---->| DIR    |     |             |   |             |
    |     5V |---->| VCC_IO |     |             |   |             |
    |     5V |---->| VM     |     |             |   |             |
    |    GND |---->| GND    |     |             |   |             |
    |        |     | A1     |---->| Spole A (Rød)|   |             |
    |        |     | A2     |---->| Spole A (Blå)|   |             |
    |        |     | B1     |---->| Spole B (Sort)|  |             |
    |        |     | B2     |---->| Spole B (Grøn)|  |             |
    |        |     +--------+     +-------------+   |             |
    |        |                                      |             |
    |    SDA |---->| LCD SDA |                      |             |
    |    SCL |---->| LCD SCL |                      |             |
    |     5V |---->| LCD VCC |                      |             |
    |    GND |---->| LCD GND |                      |             |
    |        |                                      |             |
    |    D14 |---->| Relæ-kontrol |                 |             |
    |        |                                      |             |
    |    D15 |<----| Startknap |                    |             |
    |    D16 |<----| Homing-kontakt |               |             |
    |    D17 |<----------------------------------->| CLK         |
    |    D18 |<----------------------------------->| DT          |
    |    D19 |<----------------------------------->| SW          |
    |     5V |-------------------------------------->| VCC         |
    |    GND |<------------------------------------| GND         |
    +--------+                                      +-------------+
    </pre>

    <h2>Noter</h2>
    <ol>
        <li>Sørg for, at alle GND-forbindelser er korrekt tilsluttet til en fælles jord, inklusive relæmodulets GND.</li>
        <li>Startknappen skal forbindes mellem PIN 15 og GND, med den interne pull-up modstand aktiveret i softwaren (INPUT_PULLUP).</li>
        <li>Relæ-kontrollen (PIN 14) skal forbindes til kontrolpinnen på dit relæmodul.</li>
        <li>LCD'en og andre komponenter forsynes fra den fælles 5V-forsyning.</li>
        <li>Steppermotorforbindelserne (A1, A2, B1, B2) går til TMC2209-driveren, ikke direkte til ESP32.</li>
        <li>Indstil TMC2209-strømmen ved hjælp af det indbyggede potentiometer. Strøm (RMS) = Vref * 1,77</li>
        <li>For fuld-step tilstand (laveste opløsning), forbind både MS1 og MS2 til GND.</li>
        <li>Motorstrømforsyningen (VM) til TMC2209 bruger den fælles 5V-forsyning, hvilket burde være tilstrækkeligt til denne steppermotor.</li>
        <li>Dobbelttjek alle forbindelser, før du tænder for systemet.</li>
        <li>Se TMC2209-databladet for yderligere funktioner og konfigurationsmuligheder.</li>
        <li>Tilføj en kondensator (typisk 100μF til 470μF) mellem strømforsyningens GND og + terminaler for støjreduktion og stabilisering af strømforsyningen.</li>
    </ol>

    <p>Dette ledningsdiagram giver en visuel repræsentation af, hvordan de forskellige komponenter forbindes til ESP32 og TMC2209-stepperdriveren. Se altid de specifikke datablade for dine komponenter for eventuelle yderligere forbindelser eller krav, der ikke er vist her. Den tilføjede kondensator hjælper med at reducere støj og stabilisere strømforsyningen, hvilket kan forbedre systemets overordnede ydeevne og pålidelighed.</p>
</body>
</html>
